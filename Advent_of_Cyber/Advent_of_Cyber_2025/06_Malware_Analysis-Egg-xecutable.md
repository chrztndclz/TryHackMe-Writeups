## Introduction

---

#### The Story

The town of Wareville remains quiet in the middle of the night. While the residents of Wareville are nicely tucked up in bed, blissfully unaware, the SOC team at _The Best Festival Company (TBFC)_ remain alert, poised and ready for whatever may face them.

Monitoring their screens, armed with a freshly poured mug of hot cocoa, the elves of the SOC watch their dashboards diligently. 

Suddenly, the elves receive an email in unison from Elf McClause, Head of Elf Affairs, in their inboxes. It reads:
```
**From:** Elf McClause

**Subject:** A new schedule awaits

**Attachments:** HopHelper.exe

To all Elves, going forward, we will be using a new program for creating and viewing team rotas. 

This new program will revolutionalise how rotas are made here at The Best Festival Company.

Please contact IT support if you have issues running the program.

Kind regards, remain the best,

Elf McClause

Head of Elf Affairs
```


_"Why is Elf McClause working at 3AM?"_ Screams a member of the SOC team in the background. They're right, something is amiss.

Elf McBlue is immediately suspicious. Their years of experience in the SOC have given them the wisdom not to download "out of the blue" executables. Without McSkidy's wisdom, Elf McBlue takes charge, loading up their malware investigation toolkik - the investigation begins.

#### Learning Objectives

Today's room will have you taking the place of Elf McBlue, a highly talented member of The Best Festival Company's malware investigation squad. You have been tasked with investigating a highly suspicious executable that is being shared within the company. In today's room, we will be covering the following:

- The principles of malware analysis
- An introduction to sandboxes
- Static vs. dynamic analysis
- Tools of the trade: PeStudio, ProcMon, Regshot

---

## Walkthrough 

**01 Introduction to Malware Analysis**

Malware analysis helps us understand what a malicious file does so we can defend against it. It includes two approaches:

```
- Static Analysis: Inspecting the file without running it.
- Dynamic Analysis: Running the file in a safe sandbox to observe behaviour.
```

Always use isolated environments (VMs) to avoid real system damage. You’ll apply these techniques to HopHelper.exe in the provided analyst machine.

**02 Static Analysis**

Static analysis provides quick insights before execution.

```
Using PeStudio, you can gather:

- Checksums (e.g., SHA256)
- Strings (URLs, IPs, commands)
- Imports (Windows APIs used)
- Resources (icons or embedded data)

Steps:

- Open PeStudio → load HopHelper.exe.
- Check the SHA256.
- Review strings, imports, and resources for clues.
```


**03 Dynamic Analysis**

Dynamic analysis shows how the sample behaves when running.

**Regshot**
```
- Open Regshot → set output path.
- Take 1st snapshot.
- Run HopHelper.exe.
- Take 2nd snapshot → Compare.
- Look for registry changes, especially persistence keys.
```

**
ProcMon**
```
- Open ProcMon → run HopHelper.exe.
- Stop capture after ~1 minute.
- Filter by Process Name = HopHelper.exe.
- Look for key actions: file creation, registry edits, TCP connections.
```

---

## Objective

Static analysis: What is the SHA256Sum of the HopHelper.exe?

 launch PeStudio and load the executable into it

 <img width="1853" height="855" alt="image" src="https://github.com/user-attachments/assets/5f933d25-33a2-4ff4-84d7-d0bb31e27a6f" />

<img width="1861" height="849" alt="image" src="https://github.com/user-attachments/assets/f302d801-9040-47d2-bbc2-ddfbe08fa807" />


`file > sha256 - F29C270068F865EF4A747E2683BFA07667BF64E768B38FBB9A2750A3D879CA33`

---

Static analysis: Within the strings of HopHelper.exe, a flag with the format THM{XXXXX} exists. What is that flag value?

Note, this can be found towards the bottom of the strings output.

<img width="1865" height="848" alt="image" src="https://github.com/user-attachments/assets/e0f10eb8-cb27-4f50-a8cd-60473053f5de" />

`THM{STRINGS_FOUND}`

---

Dynamic analysis: What registry value has the HopHelper.exe modified for persistence?

Note: Provide the full path of the key that has been modified


Launch the regshot software and provide the path of the "dekstop" in the output path

1st shot - System

C:\Users\DFIRUser\Desktop\HopHelper

<img width="1348" height="836" alt="image" src="https://github.com/user-attachments/assets/d44227e7-113f-4a56-8d37-ac8fc2cabef7" />


2nd shot - System where .exe file is already executed 

<img width="1353" height="846" alt="image" src="https://github.com/user-attachments/assets/64cb9e44-2f42-4ba0-ba8c-bd9993a2893d" />


Compare 

<img width="1358" height="745" alt="image" src="https://github.com/user-attachments/assets/4e3d09cb-3325-482c-96e1-7a9c5595d748" />


crtl + F to search "hophelper"

<img width="1864" height="850" alt="image" src="https://github.com/user-attachments/assets/671e3847-36bc-4c11-9cd9-be3d8798c4d0" />


`HKU\S-1-5-21-1966530601-3185510712-10604624-1008\Software\Microsoft\Windows\CurrentVersion\Run\HopHelper`

---

Dynamic analysis: Filter the output of ProcMon for "TCP" operations. What network protocol is HopHelper.exe using to communicate?

Make sure to have executed HopHelper.exe while ProcMon was open and capturing events.

Launch Procmon

<img width="1860" height="861" alt="image" src="https://github.com/user-attachments/assets/61b41209-dfba-4a6a-9c39-6f8dc1a52676" />


Execute the .exe file and stop the capture 

<img width="1860" height="857" alt="image" src="https://github.com/user-attachments/assets/78cd7fd7-20b3-421c-8dbd-811303f27afc" />

**Add Process Name Filter**

Apply the **Process Name** filter
Set the condition to **contains**
Put in the name of the process to **HopHelper**
Press the **Add button** to apply this filter
And finally click OK to save.

<img width="1631" height="841" alt="image" src="https://github.com/user-attachments/assets/475a6c23-a6cd-4124-8c5d-2f99a8097205" />

**Add Operation Filter**

Apply the **Operation** filter
Set the condition to **contains**
Put in the name of the process to **TCPr**
Press the **Add button** to apply this filter
And finally click OK to save.

<img width="1647" height="855" alt="image" src="https://github.com/user-attachments/assets/648059bd-c972-4c19-90a2-aed9fb888756" />


<img width="1674" height="849" alt="image" src="https://github.com/user-attachments/assets/36ac41a6-8545-42a7-8cfa-7063640e620d" />

`http`

---

## Key Takeaways

- Suspicious executables should never be trusted, especially when delivered unexpectedly, even from seemingly legitimate sources.

- Static analysis quickly reveals useful intel such as hashes, strings, and imported libraries without running the malware.

- Dynamic analysis shows the malware’s real behaviour — persistence modifications, system interactions, and potential network communication.

- PeStudio, Regshot, and ProcMon provide a strong triad of visibility for early-stage malware investigations.

- The sample HopHelper.exe attempted persistence via a Run key and communicated using HTTP, confirming malicious intent.

---

## Reflection

This exercise reinforced the importance of careful scrutiny and a methodical approach when handling unknown executables. Using both static and dynamic techniques gave a complete picture of what the malware does and how it tries to maintain access. The investigation also highlighted how small clues — like odd working hours or unexpected attachments — can be early indicators of compromise. Taking the role of Elf McBlue emphasized the value of SOC vigilance and the need for reliable tools and disciplined processes when responding to potential threats.

If you want, I can also generate a more narrative or more concise version

